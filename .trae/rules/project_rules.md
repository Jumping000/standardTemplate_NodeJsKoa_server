# 项目AI开发约束文档

## 项目概述
- **技术栈**: Node.js + Koa.js + ES Modules
- **架构模式**: MVC (Model-View-Controller)

## 技术栈约束

### 核心框架
- **必须使用**: Koa.js 作为主要Web框架
- **模块系统**: 严格使用ES Modules (import/export)
- **包管理器**: 必须使用pnpm，禁止使用npm或yarn

## 项目架构约束

### 目录结构
```
server/
├── app.js              # 主应用入口文件
├── controllers/        # 控制器层(业务逻辑处理)
├── middleware/         # 中间件
├── routes/            # 路由定义
├── public/            # 静态资源
├── config/            # 配置文件
├── models/            # 数据模型层
├── infrastructure/    # 基础设施初始化
└── package.json       # 项目配置
```

### 目录职责严格约束
**严格按目录职责开发，禁止跨职责混合**

#### 各目录职责
- **config/**: 仅配置文件（数据库、服务器、环境变量等）
- **controllers/**: 仅业务逻辑处理（请求处理、数据验证、响应格式化）
- **middleware/**: 仅中间件（请求拦截、认证、日志等）
- **routes/**: 仅路由定义（路径映射、HTTP方法绑定）
- **infrastructure/**: 仅基础设施初始化（数据库连接、服务集成、系统初始化等）
- **models/**: 仅数据模型（数据结构、数据库模型、验证规则、数据访问层、业务逻辑层）
  - **models/xxx/**: 用户相关数据模型
    - `xxxx.model.js` - 数据模型（映射表结构、类型、约束等）
    - `xxxx.repository.js` - 数据访问层（数据库基础操作等）
    - `xxxx.validation.js` - 数据验证层（输入验证、业务逻辑验证等）
    - `xxxx.service.js` - 业务逻辑层（调用repository、处理数据等）
- **public/**: 仅静态资源（HTML、CSS、JS、图片、字体）

## 编码规范约束

### JavaScript规范
- 使用ES6 import/export语法
- 使用async/await模式
- 优先使用const，需要重新赋值时使用let
- 优先使用箭头函数

### Koa.js特定规范
- 使用@koa/router进行路由管理
- 实现统一的错误处理中间件

### API设计规范
- 遵循REST API设计原则
- 统一JSON响应格式
- 正确使用HTTP状态码

### 代码质量约束

#### 命名规范
- **变量名**: 使用驼峰命名法(camelCase)，语义明确，避免缩写
- **函数名**: 使用驼峰命名法，动词开头，清晰表达功能
- **常量名**: 使用全大写字母和下划线(UPPER_SNAKE_CASE)
- **文件名**: 使用小写字母和连字符(kebab-case)或驼峰命名法
- **类名**: 使用帕斯卡命名法(PascalCase)

#### 代码注释要求
- **函数注释**: 复杂函数必须包含JSDoc格式注释，说明参数、返回值和功能
- **业务逻辑注释**: 复杂业务逻辑必须添加行内注释说明
- **TODO注释**: 临时代码或待优化部分使用TODO标记
- **禁止无意义注释**: 避免重复代码逻辑的冗余注释

#### 文件和函数复杂度限制
- **单个文件**: 不超过600行代码(不包括注释和空行)
- **单个函数**: 不超过200行代码，参数不超过5个
- **嵌套层级**: 代码嵌套层级不超过4层
- **圈复杂度**: 单个函数圈复杂度不超过10

## 开发流程约束

### 文件修改原则
1. 优先编辑现有文件，避免不必要的新文件创建
2. 新功能应放在对应的目录中
3. 遵循现有代码风格

## 禁止操作

### 架构禁止
- ❌ 破坏MVC架构
- ❌ 在app.js中写业务逻辑
- ❌ 随意修改目录结构
- ❌ 违反目录职责约束

### 开发禁止
- ❌ 忽略错误处理

## AI助手特定约束

### 代码生成要求
- 生成可立即运行的代码
- 包含所有必要的import语句
- 遵循项目现有的代码风格
- 考虑与现有代码的集成

### 功能实现要求
- 考虑完整的请求-响应流程
- 提供适当的错误处理机制
- 确保API的一致性和可用性

### 测试验证约束
- 完成功能开发或修改后，除非用户明确要求验证测试功能，否则不要主动进行功能测试
- 专注于代码实现的完整性和正确性，避免不必要的测试步骤

---
